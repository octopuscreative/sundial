(function(){var Sundial,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Sundial=function(){function Sundial(el,options){var key,val;null==options&&(options={}),this.incrementCurrentMonth=bind(this.incrementCurrentMonth,this),this.decrementCurrentMonth=bind(this.decrementCurrentMonth,this),this.setCurrentMonth=bind(this.setCurrentMonth,this),this.hide=bind(this.hide,this),this.show=bind(this.show,this),this.settings={enableSidebar:!0,enableTimePicker:!0,allowEmptyDate:!0,classPrefix:"sundial",wrapperTagName:"div",currentMonth:moment(),minDate:null,maxDate:null,enableDate:null,weekStart:0,timePickerDescription:"Format: 24hr",inputFormat:"YYYY, dddd MMM Do, h:mmA Z",dayOfWeekFormat:"ddd",sidebarYearFormat:"YYYY",sidebarDateFormat:"ddd, MMM D",sidebarTimeFormat:"h:mmA Z"};for(key in options)val=options[key],this.settings[key]=val;this.currentMonth=this.settings.currentMonth.startOf("month"),this.els={},this.els.input=el,this._buildPopover(),this._wrapEl(),this._bindEvents(),this._buildCalendar()}return Sundial.prototype.show=function(){return console.log("should show")},Sundial.prototype.hide=function(){return console.log("should hide")},Sundial.prototype.setCurrentMonth=function(year,month){return this.currentMonth=moment(year+"-"+month,"YYYY-M").startOf("month"),this._buildCalendar()},Sundial.prototype.decrementCurrentMonth=function(){return this.currentMonth.subtract(1,"month").startOf("month"),this._buildCalendar()},Sundial.prototype.incrementCurrentMonth=function(){return this.currentMonth.add(1,"month").startOf("month"),this._buildCalendar()},Sundial.prototype._makeEl=function(tagName,className,innerText){var el;return el=document.createElement(tagName),null!=className&&(el.className=className),null!=innerText&&(el.innerText=innerText),el},Sundial.prototype._buildPopover=function(){return this.els.popover=this._makeEl("div",this.settings.classPrefix+"-popover"),this.settings.enableSidebar===!0&&this._buildSidebar(),this.els.pickerContainer=this._makeEl("div",this.settings.classPrefix+"-picker-container"),this.els.popover.appendChild(this.els.pickerContainer),this._buildDatePicker(),this.settings.enableTimePicker===!0&&this._buildTimePicker(),document.body.appendChild(this.els.popover)},Sundial.prototype._buildSidebar=function(){return this.els.sidebar=this._makeEl("div",this.settings.classPrefix+"-sidebar"),this.els.sidebarYear=this._makeEl("p",this.settings.classPrefix+"-sidebar-year"),this.els.sidebar.appendChild(this.els.sidebarYear),this.els.sidebarDate=this._makeEl("p",this.settings.classPrefix+"-sidebar-date"),this.els.sidebar.appendChild(this.els.sidebarDate),this.settings.enableTimePicker===!0&&(this.els.sidebarTime=this._makeEl("p",this.settings.classPrefix+"-sidebar-time"),this.els.sidebar.appendChild(this.els.sidebarTime)),this.els.popover.appendChild(this.els.sidebar)},Sundial.prototype._buildDatePicker=function(){return this.els.datePicker=this._makeEl("div",this.settings.classPrefix+"-date-picker"),this.els.datePickerHeader=this._makeEl("header",this.settings.classPrefix+"-date-picker-header"),this.els.datePickerDecrementMonth=this._makeEl("button",this.settings.classPrefix+"-date-picker-decrement-month","Previous Month"),this.els.datePickerHeaderText=this._makeEl("p",this.settings.classPrefix+"-date-picker-header-text"),this.els.datePickerIncrementMonth=this._makeEl("button",this.settings.classPrefix+"-date-picker-increment-month","Next Month"),this.els.datePickerHeader.appendChild(this.els.datePickerDecrementMonth),this.els.datePickerHeader.appendChild(this.els.datePickerHeaderText),this.els.datePickerHeader.appendChild(this.els.datePickerIncrementMonth),this.els.calendarContainer=this._makeEl("div",this.settings.classPrefix+"-calendar-container"),this.els.datePicker.appendChild(this.els.datePickerHeader),this.els.datePicker.appendChild(this.els.calendarContainer),this.els.pickerContainer.appendChild(this.els.datePicker)},Sundial.prototype._buildTimePicker=function(){var h,hourEl,j,k,m,minuteEl;for(this.els.timePicker=this._makeEl("div",this.settings.classPrefix+"-time-picker"),this.els.timePickerHour=this._makeEl("select",this.settings.classPrefix+"-time-picker-hour"),this.els.timePickerMinute=this._makeEl("select",this.settings.classPrefix+"-time-picker-minute"),this.els.timePickerDescription=this._makeEl("p",this.settings.classPrefix+"-time-picker-description",this.settings.timePickerDescription),h=j=0;23>=j;h=++j)hourEl=this._makeEl("option",null,("0"+h).slice(-2)),this.els.timePickerHour.appendChild(hourEl);for(m=k=0;59>=k;m=++k)minuteEl=this._makeEl("option",null,("0"+m).slice(-2)),this.els.timePickerMinute.appendChild(minuteEl);return this.els.timePicker.appendChild(this.els.timePickerHour),this.els.timePicker.appendChild(this.els.timePickerMinute),this.els.timePicker.appendChild(this.els.timePickerDescription),this.els.pickerContainer.appendChild(this.els.timePicker)},Sundial.prototype._wrapEl=function(){var nextSibling,parent;return this.els.wrapper=this._makeEl(this.settings.wrapperTagName,this.settings.classPrefix+"-wrapper"),parent=this.els.input.parentNode,nextSibling=this.els.input.nextSibling,this.els.wrapper.appendChild(this.els.input),nextSibling?parent.insertBefore(this.els.wrapper,nextSibling):parent.appendChild(this.els.wrapper)},Sundial.prototype._bindEvents=function(){return this.els.input.addEventListener("focus",this.show,!0),this.els.datePickerDecrementMonth.addEventListener("click",this.decrementCurrentMonth,!0),this.els.datePickerIncrementMonth.addEventListener("click",this.incrementCurrentMonth,!0)},Sundial.prototype._buildCalendarHeader=function(){var days,i,j;for(days=["<tr>"],i=j=0;7>j;i=++j)days.push("<th>"+moment().set("day",i+this.settings.weekStart).format(this.settings.dayOfWeekFormat)+"</th>");return days.push("</tr>"),days},Sundial.prototype._buildCalendarDay=function(dayInfo){var dayClasses;return dayInfo.empty?'<td class="'+this.settings.classPrefix+'-day-empty"></td>':(dayClasses=[],dayInfo.today&&dayClasses.push(this.settings.classPrefix+"-day-today"),'<td class="'+this.settings.classPrefix+"-day "+dayClasses.join(" ")+'">\n  <button data-date="'+dayInfo.dateString+'" class="'+this.settings.classPrefix+'-day-button">\n    '+dayInfo.dayOfMonth+"\n  </button>\n</td>")},Sundial.prototype._buildCalendar=function(){var calendarMatrix,cellCount,day,dayInfo,daysAfterMonthEnd,daysBeforeMonthStart,daysInMonth,i,j,ref,rowLength;for(this.els.datePickerHeaderText.innerText=this.currentMonth.format("MMMM")+" "+this.currentMonth.format("YYYY"),calendarMatrix=[],calendarMatrix.push(this._buildCalendarHeader()),daysInMonth=this.currentMonth.daysInMonth(),daysBeforeMonthStart=this.currentMonth.day(),this.settings.weekStart>0&&(daysBeforeMonthStart-=this.settings.weekStart,0>daysBeforeMonthStart&&(daysBeforeMonthStart+=7)),cellCount=daysInMonth+daysBeforeMonthStart,daysAfterMonthEnd=cellCount;daysAfterMonthEnd>7;)daysAfterMonthEnd-=7;for(cellCount+=7-daysAfterMonthEnd,console.log("dbda",daysBeforeMonthStart,daysAfterMonthEnd),rowLength=0,i=j=0,ref=cellCount;ref>=0?ref>j:j>ref;i=ref>=0?++j:--j)0===rowLength&&calendarMatrix.push(["<tr>"]),day=this.currentMonth.clone().date(1+(i-daysBeforeMonthStart)),dayInfo={empty:daysBeforeMonthStart>i||i>=daysInMonth+daysBeforeMonthStart,today:day.isSame(moment(),"day"),dateString:day.format("YYYY-MM-DD"),dayOfMonth:day.date()},calendarMatrix[calendarMatrix.length-1].push(this._buildCalendarDay(dayInfo)),7===++rowLength&&(calendarMatrix[calendarMatrix.length-1].push("</tr>"),rowLength=0);return this._renderCalendar(calendarMatrix)},Sundial.prototype._renderCalendar=function(calendarMatrix){var calendarHtml,col,j,k,len,len1,row;for(console.log(calendarMatrix),calendarHtml="<table><tbody>",j=0,len=calendarMatrix.length;len>j;j++)for(row=calendarMatrix[j],k=0,len1=row.length;len1>k;k++)col=row[k],calendarHtml+=col;return calendarHtml+="</tbody></table>",this.els.calendarContainer.innerHTML=calendarHtml},Sundial}(),window.Sundial=Sundial}).call(this);