(function(){var Sundial,addClass,hasClass,makeEl,removeClass,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},bind=function(fn,me){return function(){return fn.apply(me,arguments)}};makeEl=function(tagName,className,innerText){var el;return el=document.createElement(tagName),null!=className&&(el.className=className),null!=innerText&&(el.innerText=innerText),el},hasClass=function(el,className){return indexOf.call(el.className.split(" "),className)>=0},addClass=function(el,className){return hasClass(el,className)?void 0:el.className=""===el.className?className:el.className+" "+className},removeClass=function(el,className){return el.className=el.className.replace(className,"").trim()},Sundial=function(){function Sundial(el,options){var key,val;null==options&&(options={}),this._handleCalendarDayClick=bind(this._handleCalendarDayClick,this),this._handlePopoverClick=bind(this._handlePopoverClick,this),this._handleInputBlur=bind(this._handleInputBlur,this),this.setSelectedMinute=bind(this.setSelectedMinute,this),this.setSelectedHour=bind(this.setSelectedHour,this),this.setSelectedDate=bind(this.setSelectedDate,this),this.incrementCurrentMonth=bind(this.incrementCurrentMonth,this),this.decrementCurrentMonth=bind(this.decrementCurrentMonth,this),this.setCurrentMonth=bind(this.setCurrentMonth,this),this.hide=bind(this.hide,this),this.show=bind(this.show,this),this.settings={enableSidebar:!0,enableTimePicker:!0,allowEmptyDate:!0,classPrefix:"sundial",wrapperTagName:"div",currentMonth:moment(),minDate:null,maxDate:null,enableDate:null,weekStart:0,timePickerDescription:"Format: 24hr",inputFormat:null,maskFormat:"YYYY, dddd MMM Do, h:mmA",dayOfWeekFormat:"dd",sidebarYearFormat:"YYYY",sidebarDateFormat:"ddd, MMM D",sidebarTimeFormat:"h:mmA",dayButtonDateFormat:"YYYY-MM-DD"};for(key in options)val=options[key],this.settings[key]=val;this.currentMonth=this.settings.currentMonth.startOf("month"),this.els={},this.els.input=el,this._setUpInput(),this._buildPopover(),this._wrapEl(),this._bindEvents(),this._buildCalendar(),this.setSelectedDate(moment(),!0)}return Sundial.prototype.show=function(){return addClass(this.els.popover,"visible"),this._positionPopover()},Sundial.prototype.hide=function(){return removeClass(this.els.popover,"visible")},Sundial.prototype.setCurrentMonth=function(year,month){return this.currentMonth=moment(year+"-"+month,"YYYY-M").startOf("month"),this._buildCalendar()},Sundial.prototype.decrementCurrentMonth=function(){return this.currentMonth.subtract(1,"month").startOf("month"),this._buildCalendar()},Sundial.prototype.incrementCurrentMonth=function(){return this.currentMonth.add(1,"month").startOf("month"),this._buildCalendar()},Sundial.prototype.setSelectedDate=function(date,setTime){var currentlySelectedHour,currentlySelectedMinute;return null==setTime&&(setTime=!1),currentlySelectedHour=this.selectedDate?this.selectedDate.hour():0,currentlySelectedMinute=this.selectedDate?this.selectedDate.minute():0,this.selectedDate=date,setTime||(this.setSelectedHour(currentlySelectedHour),this.setSelectedMinute(currentlySelectedMinute)),this._renderSelectedDateTime(),this._buildCalendar()},Sundial.prototype.setSelectedHour=function(hour){},Sundial.prototype.setSelectedMinute=function(minute){},Sundial.prototype._positionPopover=function(){var left,popoverStyle,top;return popoverStyle=this.els.popover.style,top=this.els.input.offsetHeight+this.els.input.offsetTop,left=this.els.input.offsetLeft,popoverStyle.top=top+"px",popoverStyle.left=left+"px"},Sundial.prototype._setUpInput=function(){return this.els.input.setAttribute("readonly","true")},Sundial.prototype._buildPopover=function(){var popoverStyle;return this.els.popover=makeEl("div",this.settings.classPrefix+"-popover"),popoverStyle=this.els.popover.style,popoverStyle.position="absolute",this.settings.enableSidebar===!0&&this._buildSidebar(),this.els.pickerContainer=makeEl("div",this.settings.classPrefix+"-picker-container"),this.els.popover.appendChild(this.els.pickerContainer),this._buildDatePicker(),this.settings.enableTimePicker===!0&&this._buildTimePicker(),this.els.input.offsetParent.appendChild(this.els.popover)},Sundial.prototype._buildSidebar=function(){return this.els.sidebar=makeEl("div",this.settings.classPrefix+"-sidebar"),this.els.sidebarYear=makeEl("p",this.settings.classPrefix+"-sidebar-year"),this.els.sidebar.appendChild(this.els.sidebarYear),this.els.sidebarDate=makeEl("p",this.settings.classPrefix+"-sidebar-date"),this.els.sidebar.appendChild(this.els.sidebarDate),this.settings.enableTimePicker===!0&&(this.els.sidebarTime=makeEl("p",this.settings.classPrefix+"-sidebar-time"),this.els.sidebar.appendChild(this.els.sidebarTime)),this.els.popover.appendChild(this.els.sidebar)},Sundial.prototype._buildDatePicker=function(){return this.els.datePicker=makeEl("div",this.settings.classPrefix+"-date-picker"),this.els.datePickerHeader=makeEl("header",this.settings.classPrefix+"-date-picker-header"),this.els.datePickerDecrementMonth=makeEl("button",this.settings.classPrefix+"-date-picker-decrement-month","Previous Month"),this.els.datePickerHeaderText=makeEl("p",this.settings.classPrefix+"-date-picker-header-text"),this.els.datePickerIncrementMonth=makeEl("button",this.settings.classPrefix+"-date-picker-increment-month","Next Month"),this.els.datePickerHeader.appendChild(this.els.datePickerDecrementMonth),this.els.datePickerHeader.appendChild(this.els.datePickerHeaderText),this.els.datePickerHeader.appendChild(this.els.datePickerIncrementMonth),this.els.calendarContainer=makeEl("div",this.settings.classPrefix+"-calendar-container"),this.els.datePicker.appendChild(this.els.datePickerHeader),this.els.datePicker.appendChild(this.els.calendarContainer),this.els.pickerContainer.appendChild(this.els.datePicker)},Sundial.prototype._buildTimePicker=function(){var h,hourEl,j,k,m,minuteEl;for(this.els.timePicker=makeEl("div",this.settings.classPrefix+"-time-picker"),this.els.timePickerHour=makeEl("select",this.settings.classPrefix+"-time-picker-hour"),this.els.timePickerMinute=makeEl("select",this.settings.classPrefix+"-time-picker-minute"),this.els.timePickerDescription=makeEl("p",this.settings.classPrefix+"-time-picker-description",this.settings.timePickerDescription),h=j=0;23>=j;h=++j)hourEl=makeEl("option",null,("0"+h).slice(-2)),this.els.timePickerHour.appendChild(hourEl);for(m=k=0;59>=k;m=++k)minuteEl=makeEl("option",null,("0"+m).slice(-2)),this.els.timePickerMinute.appendChild(minuteEl);return this.els.timePicker.appendChild(this.els.timePickerHour),this.els.timePicker.appendChild(this.els.timePickerMinute),this.els.timePicker.appendChild(this.els.timePickerDescription),this.els.pickerContainer.appendChild(this.els.timePicker)},Sundial.prototype._wrapEl=function(){var nextSibling,parent;return this.els.wrapper=makeEl(this.settings.wrapperTagName,this.settings.classPrefix+"-wrapper"),parent=this.els.input.parentNode,nextSibling=this.els.input.nextSibling,this.els.wrapper.appendChild(this.els.input),this.els.inputMask=makeEl("div",this.settings.classPrefix+"-input-mask"),this.els.wrapper.appendChild(this.els.inputMask),nextSibling?parent.insertBefore(this.els.wrapper,nextSibling):parent.appendChild(this.els.wrapper)},Sundial.prototype._bindEvents=function(){return this.els.input.addEventListener("focus",this.show,!1),this.els.popover.addEventListener("mousedown",this._handlePopoverClick,!1),this.els.input.addEventListener("blur",this._handleInputBlur,!1),this.els.datePickerDecrementMonth.addEventListener("click",this.decrementCurrentMonth,!1),this.els.datePickerIncrementMonth.addEventListener("click",this.incrementCurrentMonth,!1),this.els.calendarContainer.addEventListener("click",this._handleCalendarDayClick,!1)},Sundial.prototype._buildCalendarHeader=function(){var days,i,j;for(days=["<tr>"],i=j=0;7>j;i=++j)days.push("<th>"+moment().set("day",i+this.settings.weekStart).format(this.settings.dayOfWeekFormat)+"</th>");return days.push("</tr>"),days},Sundial.prototype._buildCalendarDay=function(dayInfo){var dayClasses;return dayInfo.empty?'<td class="'+this.settings.classPrefix+'-day-empty"></td>':(dayClasses=[],dayInfo.today&&dayClasses.push(this.settings.classPrefix+"-day-today"),dayInfo.selected&&dayClasses.push(this.settings.classPrefix+"-day-selected"),'<td class="'+this.settings.classPrefix+"-day "+dayClasses.join(" ")+'">\n  <button data-date="'+dayInfo.dateString+'" class="'+this.settings.classPrefix+'-day-button">\n    '+dayInfo.dayOfMonth+"\n  </button>\n</td>")},Sundial.prototype._buildCalendar=function(){var calendarMatrix,cellCount,day,dayInfo,daysAfterMonthEnd,daysBeforeMonthStart,daysInMonth,i,j,ref,rowLength;for(this.els.datePickerHeaderText.innerText=this.currentMonth.format("MMMM")+" "+this.currentMonth.format("YYYY"),calendarMatrix=[],calendarMatrix.push(this._buildCalendarHeader()),daysInMonth=this.currentMonth.daysInMonth(),daysBeforeMonthStart=this.currentMonth.day(),this.settings.weekStart>0&&(daysBeforeMonthStart-=this.settings.weekStart,0>daysBeforeMonthStart&&(daysBeforeMonthStart+=7)),cellCount=daysInMonth+daysBeforeMonthStart,daysAfterMonthEnd=cellCount;daysAfterMonthEnd>7;)daysAfterMonthEnd-=7;for(cellCount+=7-daysAfterMonthEnd,rowLength=0,i=j=0,ref=cellCount;ref>=0?ref>j:j>ref;i=ref>=0?++j:--j)0===rowLength&&calendarMatrix.push(["<tr>"]),day=this.currentMonth.clone().date(1+(i-daysBeforeMonthStart)),dayInfo={empty:daysBeforeMonthStart>i||i>=daysInMonth+daysBeforeMonthStart,today:day.isSame(moment(),"day"),dateString:day.format(this.settings.dayButtonDateFormat),dayOfMonth:day.date(),selected:day.isSame(this.selectedDate,"day")},calendarMatrix[calendarMatrix.length-1].push(this._buildCalendarDay(dayInfo)),7===++rowLength&&(calendarMatrix[calendarMatrix.length-1].push("</tr>"),rowLength=0);return this._renderCalendar(calendarMatrix)},Sundial.prototype._renderCalendar=function(calendarMatrix){var calendarHtml,col,j,k,len,len1,row;for(calendarHtml="<table><tbody>",j=0,len=calendarMatrix.length;len>j;j++)for(row=calendarMatrix[j],k=0,len1=row.length;len1>k;k++)col=row[k],calendarHtml+=col;return calendarHtml+="</tbody></table>",this.els.calendarContainer.innerHTML=calendarHtml},Sundial.prototype._renderSelectedDateTime=function(){return this.els.input.value=this.selectedDate.format(this.settings.inputFormat),this.els.inputMask.innerText=this.selectedDate.format(this.settings.maskFormat),this.settings.enableSidebar===!0&&(this.els.sidebarYear.innerText=this.selectedDate.format(this.settings.sidebarYearFormat),this.els.sidebarDate.innerText=this.selectedDate.format(this.settings.sidebarDateFormat),this.settings.enableTimePicker)?this.els.sidebarTime.innerText=this.selectedDate.format(this.settings.sidebarTimeFormat):void 0},Sundial.prototype._handleInputBlur=function(e){return this._clickedPopover?(this._clickedPopover=!1,void this.els.input.focus()):this.hide()},Sundial.prototype._handlePopoverClick=function(e){return this._clickedPopover=!0},Sundial.prototype._handleCalendarDayClick=function(e){var clicked;return clicked=e.target,hasClass(clicked,"sundial-day-button")?this.setSelectedDate(moment(clicked.dataset.date,this.settings.dayButtonDateFormat)):!0},Sundial}(),window.Sundial=Sundial}).call(this);